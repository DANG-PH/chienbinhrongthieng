<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chiến Binh Rồng Thiêng</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="images/icongame1.png" type="image/png" />
  <style>
    #toast {
    position: fixed;
    opacity:0;
    bottom:66%;
    left: 50%;
    transform: translateX(-50%);
    background: #9e9e9e;
    box-shadow: 0 4px 12px rgba(0,0,0,0.7);
    color: black;
    padding: 8px 20px;
    border-radius: 8px;
    font-size: 14px;
    z-index: 9999;
    transition: opacity 0.5s ease, transform 0.5s ease;
    }
    body.dark-mode #toast {
    background: rgba(0, 0, 0, 0.8);
    box-shadow: 0 4px 12px rgba(255,255,255,0.2);
    color: #fff;
    }
    #toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    }
    #toast.hidden {
    opacity: 0;
    pointer-events: none;
    }
    #danh-sach-huy-hieu{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:15px;
      width:75%;
      margin:auto
    }
    .huy-hieu-card {
    width: 100%;
    height:110px;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-weight: bold;
    box-shadow: 0 0 8px rgba(255,255,255,0.8);
    }
    .huy-hieu-card:hover{
      transform: translateY(-5px);
      filter: brightness(1.1);
      transition: .4s;
    }
    .dragon-god {
      background: linear-gradient(to right, #00e5ff, #7c4dff);
      box-shadow: 0 0 16px #00e5ff;
      color: white;
      font-weight: bold;
      animation: pulseDragon 2s infinite;
    }
    @keyframes pulseDragon {
      0% { transform: scale(1); box-shadow: 0 0 12px #00e5ff; }
      50% { transform: scale(1.03); box-shadow: 0 0 28px #7c4dff; }
      100% { transform: scale(1); box-shadow: 0 0 12px #00e5ff; }
    }

    .gold {
    background: linear-gradient(to right, gold, orange);
    }
    .silver {
    background: linear-gradient(to right, silver, gray);
    }
    .bronze {
    background: linear-gradient(to right, #cd7f32, #8b5e3c);
    }
    .locked {
    background: #333;
    opacity: 0.3;
    }
    body:not(.dark-mode) .huy-hieu-card {
    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.8);  
    }
    body:not(.dark-mode) .huy-hieu-card.gold {
      background: linear-gradient(to right, #ffea00, #ffc107);
    }
    body:not(.dark-mode) .huy-hieu-card.silver {
      background: linear-gradient(to right, #d3d3d3, #a9a9a9);
    }
    body:not(.dark-mode) .huy-hieu-card.bronze {
      background: linear-gradient(to right, #e8a87c, #bc6c25);
    }
    body:not(.dark-mode) .huy-hieu-card.locked {
      background: #ddd;
      color: #444;
      opacity: 0.7;
    }
    #top-users{
      width:100%;
      border-collapse:collapse;
      text-align:center;
    }
    #top-users thead{
      background-color:#2a2d32;
      box-shadow: 0 0px 2px rgba(0,0,0,1)
    }
    #top-users td, #top-users th {
    border:1px solid white;
    padding: 10px;
    }
    #top-users tr:nth-child(2n) {
    background-color: rgba(255,255,255,0.05);
    }
    #top-users tr:hover {
    background-color: rgba(255,255,255,0.1);
    }
    body:not(.dark-mode) #top-users thead{
      background-color: #ffe082;
    }
    body:not(.dark-mode) #top-users td, 
    body:not(.dark-mode) #top-users th {
      border: 1px solid #999;
    }

    body:not(.dark-mode) #top-users tr:nth-child(2n) {
      background-color: rgba(0, 0, 0, 0.03);
    }

    body:not(.dark-mode) #top-users tr:hover {
      background-color: rgba(0, 0, 0, 0.07);
    }
    .top-1 {
      color: gold;
      font-weight: bold;
      text-shadow: 0px 0px 1px gold;
    }
    .top-2 {
      color: #d0d0ff;
      font-weight: bold;
      text-shadow: 0px 0px 1px #d0d0ff;
    }
    .top-3 {
      color: #cd7f32; 
      font-weight: bold;
      text-shadow: 0px 0px 0.5px #cd7f32
    }
    body:not(.dark-mode) .top-1 {
      color: #f57f17;
      font-weight: bold;
      text-shadow: 0px 0px 1px #f57f17;
    }
    body:not(.dark-mode) .top-2 {
      color: #3f51b5;
      font-weight: bold;
      text-shadow: 0px 0px 1px #3f51b5;
    }
    body:not(.dark-mode) .top-3 {
      color: #a0522d;
      font-weight: bold;
      text-shadow: 0px 0px 0.5px #a0522d;
    }

    #ds-thanh-tich-an{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      width: 75%;
      margin: auto;
      gap:15px
    }
    .thanh-tich-card {
    width: 100%;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-style: italic;
    opacity: 0.4;
    box-shadow: 0 0 8px rgba(255,255,255,0.8);
    }
    .thanh-tich-card:hover{
      transform: translateY(-5px);
      transition: .4s;
    }
    body:not(.dark-mode) .thanh-tich-card {
      background: linear-gradient(to bottom, #ffffff, #f0f0f0);
      color: #333;
      box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.8);  
      opacity: 0.6;
    }
    .avatar-frame {
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid transparent;
    }

    .vip-frame-0 { border-color: gray; }
    .vip-frame-1 { border-color: #ffeb3b; box-shadow: 0 0 6px #ffeb3b}
    .vip-frame-2 { border-color: #ffc107; box-shadow: 0 0 8px #ffc107 }
    .vip-frame-3 { border-color: gold; box-shadow: 0 0 10px gold }
    .vip-frame-4 { border-color: #ff1744;box-shadow: 0 0 12px #ff1744 }
    .vip-frame-5 { border-color: #2979ff; box-shadow: 0 0 12px #2979ff ;animation: glow-vip5 2.5s infinite;}
    .vip-frame-6 { border-color: #ec407a;box-shadow: 0 0 12px #ec407a ;animation: glow-vip6 2.5s infinite;}
    .vip-frame-7 { border-color: #b2ebf2; box-shadow: 0 0 12px #b2ebf2 ;animation: glow-vip7 2.5s infinite;}
    .vip-frame-8 { border-color: #00e5ff; box-shadow: 0 0 12px #00e5ff ;animation: glow-vip8 2.5s infinite;}
    .legendary-frame {
      border-color: 		#B0F1FF;
      box-shadow: 0 0 25px 	#B0F1FF;
      animation: glow-pulse 2.5s infinite

    }
    body.dark-mode .legendary-frame {
      border-color: #ffffff;
      box-shadow: 0 0 25px #ffffff;
      animation: glow-pulse1 2.5s infinite;
      
    }
    @keyframes glow-vip5 {
      0% { box-shadow: 0 0 7px #2979ff; }
      50% { box-shadow: 0 0 21px #2979ff; }
      100% { box-shadow: 0 0 7px #2979ff; }
    }
    @keyframes glow-vip6 {
      0% { box-shadow: 0 0 9px #ec407a; }
      50% { box-shadow: 0 0 24px #ec407a; }
      100% { box-shadow: 0 0 9px #ec407a; }
    }
    @keyframes glow-vip7 {
      0% { box-shadow: 0 0 10px #b2ebf2; }
      50% { box-shadow: 0 0 28px #b2ebf2; }
      100% { box-shadow: 0 0 10px #b2ebf2; }
    }
    @keyframes glow-vip8 {
      0% { box-shadow: 0 0 10px #00e5ff; }
      50% { box-shadow: 0 0 32px #00e5ff; }
      100% { box-shadow: 0 0 10px #00e5ff; }
    }
    @keyframes glow-pulse {
      0% {
        transform: scale(1);
        box-shadow:0 0 15px #00e5ff
      }
      50% {
        transform: scale(1.03);
        box-shadow:0 0 45px #00e5ff
      }
      100% {
        transform: scale(1);
        box-shadow:0 0 15px #00e5ff
      }
    }
    @keyframes glow-pulse1 {
      0% {
        transform: scale(1);
        box-shadow: 0 0 15px #ffffff;
      }
      50% {
        transform: scale(1.03);
        box-shadow: 0 0 45px #ffffff;
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 15px #ffffff;
      }
    }
    .huy-hieu-card button {
      padding: 8px 12px;
    }

    @media (max-width: 768px){
      #danh-sach-huy-hieu{
        font-size:10px;
        grid-template-columns: repeat(2,1fr);
      }
      .huy-hieu-card {
        height:80px
      }
      #top-users {
        font-size: 8px;
      }

      #top-users img {
        width: 25px !important;
        height: 25px !important;
      }

      #top-users td {
        padding: 4px;
      }
      #ds-thanh-tich-an{
        grid-template-columns: repeat(2,1fr);
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div style="overflow: hidden;">
      <video autoplay muted loop playsinline preload="metadata"poster="images/vid1.webp" class="header-video" style="animation: vid1 10s infinite;height:120%;filter: brightness(0.9)">
        <source src="images/vd1.webm" type="video/webm">
        <source src="images/vd1.mp4" type="video/mp4">
      </video>
      <video autoplay muted loop playsinline preload="metadata" poster="images/vid3.webp" class="header-video" style="animation: vid2 10s infinite;filter: brightness(0.9);height:165%">
        <source src="images/vd3.webm" type="video/webm">
        <source src="images/vd3.mp4" type="video/mp4">
      </video>
    </div>
    <div class="overlay"></div>
        <div class="header-content" >
            <h1>Bảng Vàng Vinh Quang</h1>
            <div>
              <ul>
                <li><a href="index.html">Trang chủ</a></li>
                <li><a href="gioithieu.html">Giới thiệu</a></li>
                <li><a href="nhanvat.html">Nhân Vật</a></li>
                <li><a href="diendan.html">Diễn đàn</a></li>
                <li><a href="https://www.facebook.com/people/Chi%E1%BA%BFn-Binh-R%E1%BB%93ng-Thi%C3%AAng/61576541835732/" target="_blank">Fanpage</a></li>
                <li><a href="tintuc.html">Tin tức</a></li>
                <li><a href="huongdanchoi.html">Hướng dẫn chơi</a></li>
                <li><a href="choingay.html">Chơi ngay</a></li>
                <li><a href="naptien.html">Nạp game</a></li>
                <li><a href="shop.html">Shop rồng thiêng</a></li>
                <li><a href="chatbot.html">Chat bot hỗ trợ</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="vinhdanh.html" id="selected">Vinh danh chiến binh</a></li>
              </ul>
            </div>
        </div>
    </div>

    <div class="bg-content1">
        <div style="float:right;margin-top:5px">
            <label class="switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider round"></span>
            </label>
        </div>
        <h2>Truyền Thuyết Được Viết Bằng Sức Mạnh Và Ý Chí !</h2>
        <p><i><b>Không cần sinh ra vĩ đại — chỉ cần dám chiến đấu! Từng đòn tung ra, từng chiến thắng đạt được... là từng dòng truyền thuyết được viết nên bởi chính bạn!</b></i></p>

    </div>
    <div id="huy-hieu" class="bg-content1">
        <h2 style="text-align:center">🎖️ HUY HIỆU</h2>
        <div id="danh-sach-huy-hieu"></div>
    </div>
    <div class="bg-content1">
        <h2 style="text-align:center">🏆 BẢNG XẾP HẠNG CHIẾN BINH</h2>
        <table id="top-users">
            <thead>
                <tr>
                <th>Hạng</th>
                <th>Chiến Binh</th>
                <th>Tổng Zeni</th>
                <th>VIP</th>
                <th>Danh Hiệu</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div id="thanh-tich-sap-mo" class="bg-content1">
        <h2 style="text-align:center">🔓 THÀNH TÍCH SẮP ĐẠT</h2>
        <div id="ds-thanh-tich-an" ></div>
    </div>

    <audio id="bg-music" autoplay loop>
        <source src="sounds/phepmau.mp3" type="audio/mpeg">
        Trình duyệt của bạn không hỗ trợ âm thanh.
    </audio>
    <button id="toggle-music" class="music-toggle-btn">🔇</button>
    <footer>
        <p style="font-style: italic;"><strong>© 2025 Chiến Binh Rồng Thiêng | Phạm Hải Đăng</strong></p>
    </footer>
    <div id="toast" class="hidden"></div>
    <script>
        const toggle = document.getElementById("darkModeToggle");

        // Khi tải trang: kiểm tra trạng thái dark mode đã lưu
        if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
        toggle.checked = true;
        }

        // Khi người dùng bật/tắt dark mode
        toggle.addEventListener("change", function () {
        const isDark = toggle.checked;
        document.body.classList.toggle("dark-mode", isDark);
        localStorage.setItem("darkMode", isDark);
        });
        //audio 
        const bgMusic = document.getElementById("bg-music");
        bgMusic.volume=0.8
        const toggleMusicBtn = document.getElementById("toggle-music");

        let isMusicPlaying = localStorage.getItem("musicPlaying") !== "false"; // mặc định là true

        if (!isMusicPlaying) {
          bgMusic.pause();
          toggleMusicBtn.textContent = "🔇";
        } else {
          const savedTime = sessionStorage.getItem("bgMusicTime");
          if (savedTime) {
            bgMusic.currentTime = parseFloat(savedTime);
          }
          bgMusic.play();
          toggleMusicBtn.textContent = "🔊";
        }

        toggleMusicBtn.addEventListener("click", function () {
          isMusicPlaying = !isMusicPlaying;
          if (isMusicPlaying) {
            bgMusic.play();
            toggleMusicBtn.textContent = "🔊";
          } else {
            bgMusic.pause();
            toggleMusicBtn.textContent = "🔇";
          }
          localStorage.setItem("musicPlaying", isMusicPlaying);
        });
        window.addEventListener("beforeunload", () => {
          sessionStorage.setItem("bgMusicTime", bgMusic.currentTime);
        });
        
    </script>
    <script>
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const currentSession = JSON.parse(sessionStorage.getItem("currentUser"));
    const container = document.getElementById("danh-sach-huy-hieu");
    if (!currentSession) {
        container.innerHTML = '<p style="text-align:center;grid-column: 1 / -1;">⚠️ Bạn cần đăng nhập để xem huy hiệu của mình.</p>';
    } else {
        const user = users.find(u => u.email === currentSession.email);
        const tongZeni = user.history?.reduce((sum, h) => sum + h.zeni, 0) || 0;
        const items = user.items?.length || 0;
        const soNgay = user.ngayDangNhap || 1; // nếu bạn có lưu
        user.thanhTich = user.thanhTich || [];
        let html = "";

        // Rồng Vàng
        if (tongZeni >= 100000 && !user.thanhTich.includes("rongvang")) {
          html += `
            <div class="huy-hieu-card locked" id="card-rongvang">
              💎 Rồng Vàng<br/>
              Nạp trên 100.000 Zeni<br/>
              <button onclick="nhanThuong('rongvang', 20000, 'gold')">Nhận thưởng</button>
            </div>`;
        } else if (user.thanhTich.includes("rongvang")) {
          html += `
            <div class="huy-hieu-card gold">
              💎 Rồng Vàng<br/>Nạp trên 100.000 Zeni<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              💎 Rồng Vàng<br/>Cần thêm ${(100000 - tongZeni).toLocaleString()} Zeni
            </div>`;
        }


        // Thợ săn vật phẩm
        if (items >= 10 && !user.thanhTich.includes("hunter10")) {
        html += `
          <div class="huy-hieu-card locked" id="card-hunter10">
            🛍️ Thợ Săn Vật Phẩm<br/>
            Đã mua 10 vật phẩm<br/>
            <button onclick="nhanThuong('hunter10', 300000, 'silver')">
              Nhận thưởng
            </button>
          </div>`;
        } else if (user.thanhTich.includes("hunter10")) {
          html += `
            <div class="huy-hieu-card silver">
              🛍️ Thợ Săn Vật Phẩm<br/>Đã mua 10 vật phẩm<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              🛍️ Thợ Săn Vật Phẩm<br/>Còn ${10 - items} món nữa
            </div>`;
        }

        // Đăng nhập chăm chỉ
        if (soNgay >= 2 && !user.thanhTich.includes("login5")) {
          html += `
            <div class="huy-hieu-card locked" id="card-login5">
              📅 Chiến Binh Chăm Chỉ<br/>
              Đăng nhập 2 ngày<br/>
              <button onclick="nhanThuong('login5', 200000, 'bronze')">
                Nhận thưởng
              </button>
            </div>`;
        } else if (user.thanhTich.includes("login5")) {
          html += `
            <div class="huy-hieu-card bronze">
              📅 Chiến Binh Chăm Chỉ<br/>Đăng nhập 2 ngày<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              📅 Chiến Binh Chăm Chỉ<br/>Còn ${2 - soNgay} ngày nữa
            </div>`;
        }

        // Thần Rồng Gọi Tên
        if (tongZeni >= 500000 && !user.thanhTich.includes("vipmax")) {
          html += `
            <div class="huy-hieu-card locked" id="card-vipmax">
              🐉 Thần Rồng Gọi Tên<br/>
              VIP cấp cao nhất<br/>
              <button onclick="nhanThuong('vipmax', 500000, 'dragon-god')">
                Nhận thưởng VIP
              </button>
            </div>`;
        } else if (user.thanhTich.includes("vipmax")) {
          html += `
            <div class="huy-hieu-card dragon-god">
              🐉 Thần Rồng Gọi Tên<br/>VIP cấp cao nhất<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              🐉 Thần Rồng Gọi Tên<br/>Cần thêm ${(500000 - tongZeni).toLocaleString()} Zeni
            </div>`;
        }

        // Mở Rương Nhiều Nhất
        if (items >= 17 && !user.thanhTich.includes("hunter17")) {
          html += `
            <div class="huy-hieu-card locked" id="card-hunter17">
              🎁 Mở Rương Nhiều Nhất<br/>
              Đã mua 17 vật phẩm<br/>
              <button onclick="nhanThuong('hunter17', 170000, 'silver')">
                Nhận thưởng VIP
              </button>
            </div>`;
        } else if (user.thanhTich.includes("hunter17")) {
          html += `
            <div class="huy-hieu-card silver">
              🎁 Mở Rương Nhiều Nhất<br/>Đã mua 17 vật phẩm<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              🎁 Mở Rương Nhiều Nhất<br/>Cần thêm ${17 - items} món nữa
            </div>`;
        }
        // Chăm Online
        if (soNgay >= 5 && !user.thanhTich.includes("login15")) {
          html += `
            <div class="huy-hieu-card locked" id="card-login15">
              ⏱️ Chăm Online<br/>
              Đăng nhập 5 ngày<br/>
              <button onclick="nhanThuong('login15', 300000, 'bronze')">
                Nhận thưởng VIP
              </button>
            </div>`;
        } else if (user.thanhTich.includes("login15")) {
          html += `
            <div class="huy-hieu-card bronze">
              ⏱️ Chăm Online<br/>Đăng nhập 5 ngày<br/>✅ Đã nhận thưởng
            </div>`;
        } else {
          html += `
            <div class="huy-hieu-card locked">
              ⏱️ Chăm Online<br/>Cần thêm ${5 - soNgay} ngày nữa
            </div>`;
        }
        container.innerHTML=html

    }
    function getHuyHieuHTML(ma) {
    switch(ma) {
      case "rongvang":
        return "💎 Rồng Vàng<br/>Nạp trên 100.000 Zeni";
      case "hunter10":
        return "🛍️ Thợ Săn Vật Phẩm<br/>Đã mua 10 vật phẩm";
      case "login5":
        return "📅 Chiến Binh Chăm Chỉ<br/>Đăng nhập 5 ngày";
      case "vipmax":
        return "🐉 Thần Rồng Gọi Tên<br/>VIP cấp cao nhất";
      case "hunter17":
        return "🎁 Mở Rương Nhiều Nhất<br/>Đã mua 17 vật phẩm";
      case "login15":
        return "⏱️ Chăm Online<br/>Đăng nhập 15 ngày";
    }
  }
    function nhanThuong(ma, soTien, cap) {
    const user = users.find(u => u.email === currentSession.email);
    user.thanhTich = user.thanhTich || [];
    user.kimcuong += soTien;
    user.thanhTich.push(ma);
    localStorage.setItem("users", JSON.stringify(users));
    showToast(`🎉 Nhận ${soTien.toLocaleString()} Zeni từ thành tích!`);
    const card = document.getElementById("card-" + ma);
    card.classList.remove("locked");
    card.classList.add(cap); 
    card.innerHTML = getHuyHieuHTML(ma) + "<br/>✅ Đã nhận thưởng";
  }
    function showToast(message) {
    const toast = document.getElementById("toast");
    if (!toast) return;
    toast.textContent = message;
    toast.className = "show";
    setTimeout(() => {
        toast.className = "hidden";
    }, 3000);
    }
    </script>
    <script>
    function getVipLevel(zeni) {
    if (zeni < 1000) return 0;
    if (zeni < 5000) return 1;
    if (zeni < 10000) return 2;
    if (zeni < 20000) return 3;
    if (zeni < 50000) return 4;
    if (zeni < 100000) return 5;
    if (zeni < 200000) return 6;
    if (zeni < 300000) return 7;
    if (zeni < 500000) return 8;
    if (zeni < 9999999) return 9;
    return 10; // Nếu bạn muốn có cấp “vượt max”
    }

    function getTitle(vip) {
    const titles = [
        "⚪ Tân Binh",                 // VIP 0
        "🔰 Chiến Binh Z",             // VIP 1
        "💥 Chiến Binh Tối Thượng",         // VIP 2
        "🌟 Hộ Vệ Vũ Trụ",            // VIP 3
        "💠 Kaioshin Tập Sự",              // VIP 4
        "🔥 Kaioshin Tối Cao",             // VIP 5
        "🔥 Vương Thần Sơ Khai",             // VIP 6
        "🔷 Thần Hủy Diệt",       // VIP 7
        "🔷 Thần Thiên Sứ",  // VIP 8
        "💠 Đại Thiên Sứ",            // VIP 9
        "<strong>👑 Chiến Binh Truyền Thuyết</strong>" // VIP 10+
    ];
    return titles[Math.min(vip, titles.length - 1)];
    }

    function renderBangXepHang() {
        const users = JSON.parse(localStorage.getItem("users")) || [];
        const tbody = document.querySelector("#top-users tbody");

        const sorted = users.map(u => {
        const tongZeni = u.history?.reduce((sum, h) => sum + h.zeni, 0) || 0;
        return { username: u.username, zeni: tongZeni };
        }).sort((a, b) => b.zeni - a.zeni).slice(0, 10);

        let html = "";
        sorted.forEach((u, i) => {
        const vip = getVipLevel(u.zeni);
        const title = getTitle(vip);
        let avatarURL = vip >= 0 && vip <= 8
            ? `images/avt${vip + 1}.webp`
            : "images/vip10.1.avif";
        let frameClass = vip >= 0 && vip <= 8
            ? `vip-frame-${vip}`
            : "legendary-frame";
        let topClass = i === 0 ? "top-1" : i === 1 ? "top-2" : i === 2 ? "top-3" : "";
        html += `
            <tr class="${topClass}">
            <td>Top ${i + 1}</td>
            <td>
              <table style="margin:auto">
                <tr>
                  <td style="padding: 0;border:none">
                    <img src="${avatarURL}" class="avatar-frame ${frameClass}" style="width:40px;height:40px;vertical-align:middle;">
                  </td>
                  <td style="padding-left: 8px; white-space: nowrap; vertical-align: middle;border:none">
                    ${u.username}
                  </td>
                </tr>
              </table>
            </td>
            <td>${u.zeni.toLocaleString()}</td>
            <td>VIP ${vip}</td>
            <td>${title}</td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    renderBangXepHang();
    </script>
    <script>
    function renderThanhTichAn() {
        const users = JSON.parse(localStorage.getItem("users")) || [];
        const currentSession = JSON.parse(sessionStorage.getItem("currentUser"));
        const container = document.getElementById("ds-thanh-tich-an");

        if (!currentSession) {
        container.innerHTML = '<p style="text-align:center;grid-column: 1 / -1;">⚠️ Vui lòng đăng nhập để xem mục tiêu cá nhân.</p>';
        return;
        }

        const user = users.find(u => u.email === currentSession.email);
        const tongZeni = user.history?.reduce((sum, h) => sum + h.zeni, 0) || 0;
        const items = user.items?.length || 0;
        const soNgay = user.ngayDangNhap || 1;
        user.thanhTich = user.thanhTich || [];
        let html = "";

        // Mục tiêu 1 – Rồng Lửa: nạp 200k Zeni
        if (tongZeni < 200000) {
        html += `<div class="thanh-tich-card">
            🔥 Cần nạp thêm ${(200000 - tongZeni).toLocaleString()} Zeni<br/>
            để đạt cấp <b>Rồng Lửa</b>
        </div>`;
        } else {
            if (!user.thanhTich.includes("ronglua")) {
                user.kimcuong += 50000;
                user.thanhTich.push("ronglua");
                localStorage.setItem("users", JSON.stringify(users));
                showToast("✅ Nhận 50.000 Zeni từ thành tích Rồng Lửa!");
            }
        }

        // Mục tiêu 2 – Sưu tập siêu cấp: mua 20 vật phẩm
        if (items < 12) {
        html += `<div class="thanh-tich-card">
            🛍️ Mua thêm ${12 - items} vật phẩm<br/>
            để mở khóa <b>Sưu Tầm Siêu Cấp</b>
        </div>`;
        } else{
            if (!user.thanhTich.includes("collector")) {
            user.kimcuong += 40000;
            user.thanhTich.push("collector");
            localStorage.setItem("users", JSON.stringify(users));
            showToast("✅ Nhận 40.000 Zeni từ thành tích Sưu Tầm Siêu Cấp!");
        }
        }

        // Mục tiêu 3 – Chiến Binh Trung Thành
        if (soNgay < 10) {
        html += `<div class="thanh-tich-card">
            📅 Đăng nhập thêm ${10 - soNgay} ngày<br/>
            để trở thành <b>Chiến Binh Trung Thành</b>
        </div>`;
        } else {
            if (!user.thanhTich.includes("trungthanh")) {
                user.kimcuong += 30000;
                user.thanhTich.push("trungthanh");
                localStorage.setItem("users", JSON.stringify(users));
                showToast("✅ Nhận 30.000 Zeni từ Chiến Binh Trung Thành!")
        }}
 
        // Nếu đã đạt hết
        if (html === "") {
        html = `<p style="font-style:italic;">🎉 Bạn đã hoàn thành tất cả thành tích hiện tại!</p>`;
        }

        container.innerHTML = html;
    }
    function showToast(message) {
    const toast = document.getElementById("toast");
    if (!toast) return;
    toast.textContent = message;
    toast.className = "show";
    setTimeout(() => {
        toast.className = "hidden";
    }, 3000);
    }
    renderThanhTichAn();
    </script>
    <script>
        const demoUsers = [
        {
        username: "<strong>👑 Dang Hai</strong>",
        email: "vip1@demo.cbrt",
        history: [{ zeni: 9999999 }, { zeni: 0 }],
        },
        {
        username: "Dũnggg",
        email: "vip2@demo.cbrt",
        history: [{ zeni: 50000 }],
        },
        {
        username: "Saidepchiu",
        email: "vip3@demo.cbrt",
        history: [{ zeni: 158250 }],
        },
        {
        username: "LD Thànhh",
        email: "vip4@demo.cbrt",
        history: [{ zeni: 200000 }],
        },
        {
        username: "Huy Quang",
        email: "vip5@demo.cbrt",
        history: [{ zeni: 327500 }],
        },
        {
        username: "LQC-Nopee",
        email: "vip6@demo.cbrt",
        history: [{ zeni: 488250 }],
        },
        {
        username: "NguyễnVHiệp",
        email: "vip7@demo.cbrt",
        history: [{ zeni: 32250 }],
        },
        {
        username: "chillboy",
        email: "vip8@demo.cbrt",
        history: [{ zeni: 124250 }],
        },
        {
        username: "admin",
        email: "vip9@demo.cbrt",
        history: [{ zeni: 1250 }],
        },
    ];

    const existingUsers = JSON.parse(localStorage.getItem("users")) || [];

    // Loại bỏ bản cũ bị trùng (nếu có)
    const filteredUsers = existingUsers.filter(u =>
    !demoUsers.some(bot => bot.email === u.email)
    );

    // Gộp lại: giữ user thật, thêm bot 1 lần duy nhất
    const allUsers = [...filteredUsers, ...demoUsers];

    localStorage.setItem("users", JSON.stringify(allUsers));
    </script>
</body>
</html>