<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chi·∫øn Binh R·ªìng Thi√™ng</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="images/icongame1.png" type="image/png" />
  <style>
    #toast {
    position: fixed;
    opacity:0;
    bottom:66%;
    left: 50%;
    transform: translateX(-50%);
    background: #9e9e9e;
    box-shadow: 0 4px 12px rgba(0,0,0,0.7);
    color: black;
    padding: 8px 20px;
    border-radius: 8px;
    font-size: 14px;
    z-index: 9999;
    transition: opacity 0.5s ease, transform 0.5s ease;
    }
    body.dark-mode #toast {
    background: rgba(0, 0, 0, 0.8);
    box-shadow: 0 4px 12px rgba(255,255,255,0.2);
    color: #fff;
    }
    #toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    }
    #toast.hidden {
    opacity: 0;
    pointer-events: none;
    }
    .login-button.hidden{
      display:none;
    }
    @media (max-width: 768px){
      #main-title{
        font-size: 22px;
      }
      #toast{
        font-size: 11px;
        bottom:72.5%;
      }
      a.t {
        font-size:11px
      }
    }
    a.t {
      color:black;
      text-decoration: none;
    }
    a.t:hover{
      text-decoration: underline;
    }
    .avatar-frame {
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid transparent;
    }
    .vip {
      color:#1976d2
    }
    body.dark-mode .vip {
      color:#ffa500;
    }

    .vip-frame-0 { border-color: gray; }
    .vip-frame-1 { border-color: #ffeb3b; box-shadow: 0 0 6px #ffeb3b}
    .vip-frame-2 { border-color: #ffc107; box-shadow: 0 0 8px #ffc107 }
    .vip-frame-3 { border-color: gold; box-shadow: 0 0 10px gold }
    .vip-frame-4 { border-color: #ff1744;box-shadow: 0 0 12px #ff1744 }
    .vip-frame-5 { border-color: #2979ff; box-shadow: 0 0 12px #2979ff ;animation: glow-vip5 2.5s infinite;}
    .vip-frame-6 { border-color: #ec407a;box-shadow: 0 0 12px #ec407a ;animation: glow-vip6 2.5s infinite;}
    .vip-frame-7 { border-color: #b2ebf2; box-shadow: 0 0 12px #b2ebf2 ;animation: glow-vip7 2.5s infinite;}
    .vip-frame-8 { border-color: #00e5ff; box-shadow: 0 0 12px #00e5ff ;animation: glow-vip8 2.5s infinite;}
    .legendary-frame {
      border-color: 		#B0F1FF;
      box-shadow: 0 0 25px 	#B0F1FF;
      animation: glow-pulse 2.5s infinite

    }
    body.dark-mode .legendary-frame {
      border-color: #ffffff;
      box-shadow: 0 0 25px #ffffff;
      animation: glow-pulse1 2.5s infinite;
      
    }
    @keyframes glow-vip5 {
      0% { box-shadow: 0 0 7px #2979ff; }
      50% { box-shadow: 0 0 21px #2979ff; }
      100% { box-shadow: 0 0 7px #2979ff; }
    }
    @keyframes glow-vip6 {
      0% { box-shadow: 0 0 9px #ec407a; }
      50% { box-shadow: 0 0 24px #ec407a; }
      100% { box-shadow: 0 0 9px #ec407a; }
    }
    @keyframes glow-vip7 {
      0% { box-shadow: 0 0 10px #b2ebf2; }
      50% { box-shadow: 0 0 28px #b2ebf2; }
      100% { box-shadow: 0 0 10px #b2ebf2; }
    }
    @keyframes glow-vip8 {
      0% { box-shadow: 0 0 10px #00e5ff; }
      50% { box-shadow: 0 0 32px #00e5ff; }
      100% { box-shadow: 0 0 10px #00e5ff; }
    }
  
    @keyframes glow-pulse {
      0% {
        transform: scale(1);
        box-shadow:0 0 15px #00e5ff
      }
      50% {
        transform: scale(1.03);
        box-shadow:0 0 45px #00e5ff
      }
      100% {
        transform: scale(1);
        box-shadow:0 0 15px #00e5ff
      }
    }
    @keyframes glow-pulse1 {
      0% {
        transform: scale(1);
        box-shadow: 0 0 15px #ffffff;
      }
      50% {
        transform: scale(1.03);
        box-shadow: 0 0 35px #ffffff;
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 15px #ffffff;
      }
    }
    .badge {
    display: inline-block;
    background: linear-gradient(to right, #ffcc00, #ff9900);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 13px;
    margin: 3px;
    box-shadow: 0 2px 15px rgba(255,165,0,0.5);
    }
    @media (max-width: 768px){
      .nut button{
        font-size:9px !important;
      }
      .info img{
        width: 50px !important;
        height: 50px !important;
      }
      .info span{
        font-size:9px;
      }
      .userz {
        font-size:11px !important;
      }
      .badge {
        font-size:8px  !important;
      }
      #login-btn{
        font-size:11px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div style="overflow: hidden;">
      <video autoplay muted loop playsinline preload="metadata" poster="images/choingay1.webp"class="header-video" style="animation: vid1 10s infinite;filter: brightness(0.9)">
        <source src="images/choingay1.webm" type="video/webm">
        <source src="images/choingay1.mp4" type="video/mp4">
      </video>
      <video autoplay muted loop playsinline preload="metadata" poster="images/choingay2.webp" class="header-video" style="animation: vid2 10s infinite;height:145%;filter: brightness(0.9)">
        <source src="images/choingay2.webm" type="video/webm">
        <source src="images/choingay2.mp4" type="video/mp4">
      </video>
    </div>
    <div class="overlay"></div>
        <div class="header-content" >
            <h1 id="main-title"> B·∫Øt ƒê·∫ßu Cu·ªôc Chi·∫øn!</h1>
            <div>
                <ul>
                <li><a href="index.html">Trang ch·ªß</a></li>
                <li><a href="gioithieu.html">Gi·ªõi thi·ªáu</a></li>
                <li><a href="nhanvat.html">Nh√¢n V·∫≠t</a></li>
                <li><a href="diendan.html">Di·ªÖn ƒë√†n</a></li>
                <li><a href="https://www.facebook.com/people/Chi%E1%BA%BFn-Binh-R%E1%BB%93ng-Thi%C3%AAng/61576541835732/" target="_blank">Fanpage</a></li>
                <li><a href="tintuc.html">Tin t·ª©c</a></li>
                <li><a href="huongdanchoi.html">H∆∞·ªõng d·∫´n ch∆°i</a></li>
                <li><a href="choingay.html" id="selected">Ch∆°i ngay</a></li>
                <li><a href="naptien.html">N·∫°p game</a></li>
                <li><a href="shop.html">Shop r·ªìng thi√™ng</a></li>
                <li><a href="chatbot.html">Chat bot h·ªó tr·ª£</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="vinhdanh.html">Vinh danh chi·∫øn binh</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg-content1"style="padding-top: 1px;">
        <div style="float:right;margin-top:5px">
            <label class="switch" style="margin-top:20px;margin-right: -17px;">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider round"></span>
            </label>
        </div>
        <div style="text-align: center;margin-top:51px">
          <button id="login-btn" class="login-button hidden">ƒêƒÉng nh·∫≠p ngay</button>
        </div>
        <div id="game-container"></div>
        <div class="download-buttons nut" style="text-align: center;">
          <h3><i><b>S·ª©c m·∫°nh ƒëang tr·ªói d·∫≠y! Ch·ªçn n·ªÅn t·∫£ng, b∆∞·ªõc v√†o tr·∫≠n chi·∫øn t·ªëi th∆∞·ª£ng!</b></i></h3>
          <p><i>Kh√¥ng c√≤n ƒë∆∞·ªùng lui... N·∫øu ng∆∞∆°i l√† chi·∫øn binh th·ª±c th·ª•, th√¨ ƒë√¢y l√† l√∫c b√πng n·ªï s·ª©c m·∫°nh!</i></p>
          <a href="gctcn.html"><button>JAVA</button></a>
          <a href="gctcn.html"><button>ANDROID (APK)</button></a>
          <a href="gctcn.html"><button>ANDROID (Google Play)</button></a>
          <a href="gctkn.html"><button>PC</button></a>
          <a href="choingay.html"><button>IPHONE</button></a>
        </div> 
    </div>
    <audio id="bg-music" autoplay loop>
        <source src="sounds/phepmau.mp3" type="audio/mpeg">
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ √¢m thanh.
    </audio>
    <button id="toggle-music" class="music-toggle-btn">üîá</button>
    <footer>
        <p style="font-style: italic;"><strong>¬© 2025 Chi·∫øn Binh R·ªìng Thi√™ng | Ph·∫°m H·∫£i ƒêƒÉng</strong></p>
    </footer>
    <div id="toast"></div>
    <script>
        const toggle = document.getElementById("darkModeToggle");

        // Khi t·∫£i trang: ki·ªÉm tra tr·∫°ng th√°i dark mode ƒë√£ l∆∞u
        if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
        toggle.checked = true;
        }

        // Khi ng∆∞·ªùi d√πng b·∫≠t/t·∫Øt dark mode
        toggle.addEventListener("change", function () {
        const isDark = toggle.checked;
        document.body.classList.toggle("dark-mode", isDark);
        localStorage.setItem("darkMode", isDark);
        });
        //audio 
        const bgMusic = document.getElementById("bg-music");
        bgMusic.volume=0.8
        const toggleMusicBtn = document.getElementById("toggle-music");

        let isMusicPlaying = localStorage.getItem("musicPlaying") !== "false"; // m·∫∑c ƒë·ªãnh l√† true

        if (!isMusicPlaying) {
          bgMusic.pause();
          toggleMusicBtn.textContent = "üîá";
        } else {
          const savedTime = sessionStorage.getItem("bgMusicTime");
          if (savedTime) {
            bgMusic.currentTime = parseFloat(savedTime);
          }
          bgMusic.play();
          toggleMusicBtn.textContent = "üîä";
        }

        toggleMusicBtn.addEventListener("click", function () {
          isMusicPlaying = !isMusicPlaying;
          if (isMusicPlaying) {
            bgMusic.play();
            toggleMusicBtn.textContent = "üîä";
          } else {
            bgMusic.pause();
            toggleMusicBtn.textContent = "üîá";
          }
          localStorage.setItem("musicPlaying", isMusicPlaying);
        });
        window.addEventListener("beforeunload", () => {
          sessionStorage.setItem("bgMusicTime", bgMusic.currentTime);
        });
        const loginBtn = document.getElementById("login-btn");
        const loggedInUser = JSON.parse(sessionStorage.getItem("currentUser"));
        const container = document.getElementById("game-container");
        const mainTitle = document.getElementById("main-title");
        if (!loggedInUser) {
            document.querySelector(".download-buttons").style.display = "none";
            mainTitle.textContent = "‚ÄúChi·∫øn Tr∆∞·ªùng R·ªìng Thi√™ng ƒêang G·ªçi!‚Äù";
            showToast("‚ö†Ô∏è Chi·∫øn Binh! ƒêƒÉng nh·∫≠p l√† b∆∞·ªõc ƒë·∫ßu ti√™n ƒë·ªÉ khai ph√≥ng s·ª©c m·∫°nh v√† b∆∞·ªõc v√†o cu·ªôc chi·∫øn ƒë·ªãnh m·ªánh!");
            const loginSection = loginBtn.parentElement;
            const infoTitle = document.createElement("h2");
            infoTitle.textContent = "B∆∞·ªõc v√†o th·∫ø gi·ªõi c·ªßa nh·ªØng chi·∫øn binh huy·ªÅn tho·∫°i!";
            infoTitle.style.marginTop = "20px";
            infoTitle.style.fontWeight = "bold";

            const infoDesc = document.createElement("p");
            infoDesc.textContent = "Ch·ªâ c·∫ßn m·ªôt b∆∞·ªõc ƒëƒÉng nh·∫≠p, b·∫°n s·∫Ω khai m·ªü to√†n b·ªô s·ª©c m·∫°nh v√† kh√°m ph√° cu·ªôc chi·∫øn ƒë·ªânh cao!";
            infoDesc.style.fontStyle = "italic";
            
            const thea = document.createElement("a");
            thea.classList.add("t")
            thea.textContent="Xem th√™m tr∆∞·ªõc khi chi·∫øn ƒë·∫•u"
            thea.href = "huongdanchoi.html"
            loginSection.appendChild(infoTitle);
            loginSection.appendChild(infoDesc);
            loginSection.appendChild(thea)
            loginBtn.classList.remove("hidden");
            loginBtn.addEventListener("click", function () {
              window.location.href = "dangnhap.html";
            });
            // setTimeout(() => {
            //     window.location.href = "dangnhap.html";
            // }, 5000); // ch·ªù 3s ƒë·ªÉ toast hi·ªÉn th·ªã xong
            window.onload = function () {
            const downloadLinks = document.querySelectorAll(".download-buttons a");
            downloadLinks.forEach(link => {
              if (!loggedInUser) {
                link.href = "dangnhap.html"; // n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ √©p link v·ªÅ ƒëƒÉng nh·∫≠p
              }});
        }} else {
          // 1. Hi·ªán t√™n ng∆∞·ªùi ch∆°i + n√∫t ƒëƒÉng xu·∫•t
          const userBar = document.createElement("div");
          userBar.style.display = "flex";
          userBar.style.alignItems = "center";
          userBar.style.justifyContent = "space-between";
          
          const users = JSON.parse(localStorage.getItem("users")) || [];
          const userData = users.find(u => u.email === loggedInUser.email);
          let tongZeni = 0;
          try {
            for (let i = 0; i < userData.history.length; i++) {
              tongZeni += userData.history[i].zeni;  // ‚úÖ ƒë√∫ng
            }
          } catch (e) {
            tongZeni = 0; // fallback n·∫øu history b·ªã l·ªói
          }

          const vipMoc = [0, 1000, 5000, 10000, 20000, 50000, 100000, 200000, 300000, 500000];
          let vip = 0;
          for (let i = 0; i < vipMoc.length; i++) {
            if (tongZeni < vipMoc[i]) {
              vip = i - 1;
              break;
            }
            if (i === vipMoc.length - 1) vip = i;
          }

          const avatarSrc = vip <= 8 ? `images/avt${vip + 1}.webp` : "images/vip10.1.avif";
          const frameClass = vip <= 8 ? `vip-frame-${vip}` : "legendary-frame";
          const danhHieu = [
            "Base Form", "SSJ 1 ‚ö°", "SSJ 2 ‚ö°", "SSJ 3 ‚ö°", "SSJ GOD üî•",
            "SSJ BLUE üî•", "SSJ ROSE üî•", "UI -Sign- üî∑", "True UI üî∑", "MUI üí†"
          ];

          userBar.innerHTML = `
            <div class="info"style="display: flex; align-items: center; gap: 12px;">
              <img src="${avatarSrc}" class="avatar-frame ${frameClass}" style="width: 65px; height: 65px;">
              <div>
                <p style="margin: 0; font-weight: bold;">chi·∫øn binh <span class="vip userz" >${loggedInUser.username}</span></p>
                <p style="margin: 0; font-size: 13px;"><span class="vip" style="font-weight: bold">VIP ${vip}</span> <span class="badge">${danhHieu[vip]}</span></p>
              </div>
            </div>
            <div class="nut">
              <button onclick="logout()" style="padding: 6px 12px;">ƒêƒÉng xu·∫•t</button>
            </div>
          `;

          // CH√àN userBar v√†o b√™n trong container
          container.appendChild(userBar);
          
          // 2. Th√™m iframe game + n√∫t fullscreen
          const gameWrapper = document.createElement("div");
          gameWrapper.style.marginTop="10px"
          gameWrapper.innerHTML = `
            <iframe id="game-frame" src="gktkn.html" style="width:100%; aspect-ratio: 2 / 1; border:none"></iframe>
            <div class="download-buttons nut" style="margin-top:10px;text-align:right">
              <button onclick="toggleFullScreen()" style="padding:7px 9px">To√†n m√†n h√¨nh</button>
            </div>
          `;
          container.appendChild(gameWrapper);

          // 3. Hi·ªán toast th√¥ng b√°o ƒëang t·∫£i
          showToast("üîÑ Vui l√≤ng ch·ªù... Game ƒëang ƒë∆∞·ª£c t·∫£i!");
          setTimeout(()=>{
            showToast("‚úÖ Game ƒë√£ s·∫µn s√†ng. Chi·∫øn th√¥i!")
          },7000)
          setTimeout(()=>{
            showToast("üí° M·∫πo: Chi·∫øn binh c√≥ th·ªÉ ·∫•n to√†n m√†n h√¨nh ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët h∆°n!")
          },15000)
          
        }
        function showToast(message) {
          const toast = document.getElementById("toast");
          if (!toast) return;
          toast.textContent = message;
          toast.classList.add("show");
          toast.classList.remove("hidden");
          setTimeout(() => {
              toast.classList.remove("show");
              toast.classList.add("hidden");
          }, 5000);
      }
      function toggleFullScreen() {
        const iframe = document.getElementById("game-frame");
        if (!document.fullscreenElement) {
            iframe.requestFullscreen()
        }
      }
      function logout() {
        sessionStorage.removeItem("currentUser");
        showToast("‚úÖ ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
        setTimeout(() => location.reload(), 1000); // T·∫£i l·∫°i trang ƒë·ªÉ quay v·ªÅ ch·∫ø ƒë·ªô ch∆∞a ƒëƒÉng nh·∫≠p
      }

    </script>
</body>
</html>